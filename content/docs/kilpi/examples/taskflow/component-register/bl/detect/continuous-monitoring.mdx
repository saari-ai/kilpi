---
title: "DE.CM: Continuous Monitoring"
description: Billing Portal example for continuous monitoring
---

For methodology guidance, see [DE.CM: Continuous Monitoring](/docs/kilpi/functions/detect/continuous-monitoring).

---

### DE.CM-01: Network monitoring

| What to monitor | Method | Alert threshold |
|---|---|---|
| Payment API validation failures (schema validation, amount discrepancies) by endpoint and source IP | Application logs aggregated in CloudWatch, grouped by IP and endpoint | **Critical**: >50 validation failures from a single IP in 5 minutes. **Medium**: Failure rate exceeds 2x the 7-day rolling average. |
| Failed admin login attempts per IP and per account | Authentication logs in CloudWatch, windowed counts | **Critical**: >10 failed logins for a single admin account in 10 minutes (brute force). **Critical**: >100 failed logins from a single IP in 10 minutes (credential stuffing). |
| Stripe webhook signature validation failures and source IPs | Webhook handler logs, signature check results | **Critical**: Webhook request with invalid `Stripe-Signature` header. **High**: Volume exceeds 10x daily average. **Medium**: Requests from IPs outside Stripe's published ranges. |
| Log output for secret patterns (`sk_live_`, `rk_live_`, bearer tokens) | Post-processing regex scan of log output | **Critical**: Any log line matching a known Stripe key or secret pattern. |
| Secrets manager access from unexpected IAM roles or IPs | CloudTrail events for `GetSecretValue`, grouped by caller identity | **Medium**: Access from an IAM role or IP not in the expected list. |
| Unusual payment amounts or frequency | Application logs, statistical anomaly detection on payment amounts and volumes | **High**: Single payment exceeding 5x the account's historical average. **Medium**: Payment volume from a single customer exceeding 3x daily average. |

---

### DE.CM-02: Physical environment monitoring

The Billing Portal runs entirely on AWS managed infrastructure. Physical environment monitoring is delegated to AWS under the shared responsibility model.

---

### DE.CM-03: Personnel activity monitoring

| What to monitor | Method | Alert threshold |
|---|---|---|
| Database queries by billing application user (DDL detection) | PostgreSQL audit log, filtered to billing application user | **Critical**: Any DDL statement (CREATE, DROP, ALTER) executed by the billing database user. |
| Invoice access patterns (cross-tenant check) | Application log: requesting customer ID, invoice owner ID | **High**: Invoice accessed by a customer who is not the invoice owner (IDOR attempt). |
| Admin actions on customer billing data | Admin action audit log, correlated with billing operation audit log | **High**: Admin performing bulk invoice modifications or refunds exceeding threshold ($1,000). |

---

### DE.CM-06: External service provider monitoring

| What to monitor | Method | Alert threshold |
|---|---|---|
| Dependency scanning results and CVE databases | Dependabot / equivalent scanner, CI pipeline logs | **Critical**: Critical or high CVE in a production dependency. **High**: PR merged despite failing dependency scan (CI bypass). **Medium**: Scanning job not run in 7+ days. |
| Stripe API availability and error rates | Stripe status page monitoring + Billing API error logs for Stripe calls | **High**: Stripe API returning 5xx errors for >5 minutes. **Medium**: Stripe API latency exceeding 2x historical average. |

---

### DE.CM-09: Application and runtime monitoring

| What to monitor | Method | Alert threshold |
|---|---|---|
| Payment amount discrepancies (requested vs charged) | Correlation of Billing API payment requests with Stripe charge confirmations | **Critical**: Charged amount differs from requested amount. |
| Invoice integrity (modification after finalization) | Audit log correlation: invoice marked final vs subsequent modification events | **High**: Any modification to an invoice after it has been marked as finalized. |
| Admin session age and expiry enforcement | Session store TTL queries, session age checks | **High**: Admin sessions found with age exceeding the 8-hour absolute expiry. |
| Audit log write latency and error rate | Audit log infrastructure metrics | **Medium**: Write failures or lag exceeding 30 seconds. |

---

## Alerting tiers

Every alert trigger above maps to one of three tiers. The tier determines the response time.

| Tier | Response time | Examples |
|---|---|---|
| **Critical** (immediate page) | On-call paged within 5 minutes. Response within 15 minutes. | Secret in logs. DDL by billing app user. Invalid webhook signature. Brute force / credential stuffing. Payment amount discrepancy. Critical CVE. |
| **High** (same-day investigation) | Alert to security channel. Investigation within 4 hours. | IDOR attempt on invoices. Unusual payment amounts. Admin bulk operations. Invoice modified after finalization. Session expiry failure. Stripe API outage. CI scan bypassed. |
| **Medium** (weekly review) | Included in weekly security review. Triaged within 7 days. | Elevated validation failure rate. Unusual payment volume. Unexpected secrets manager access. Webhook requests from unexpected IPs. Audit log latency. Scan not running. Stripe latency increase. |
